here below is the script to setup the vault automation.
manually in the server we r able to retrieve the token using ssm-user only. (sudo su -l ssm-user). with ec2-user and gitlab-runner user not able to retrieve.

#!/bin/sh

WORKSPACE=${CI_PROJECT_DIR}
source $WORKSPACE/env/$env.properties

echo "Integrating Vault for $CLUSTER_NAME in $env"
echo "---------------------------------------------------"

get_cluster_info() {

    echo "Get cluster details"
    echo "Cluster name: $CLUSTER_NAME"
    kubectl config current-context

    echo "---------------------------------------------------"

    echo "Create service account $SERVICE_ACCOUNT_NAME"
    kubectl create serviceaccount $SERVICE_ACCOUNT_NAME

    RBAC=$WORKSPACE/rbac.yaml
    sed -i "s|{{service_account_name}}|$SERVICE_ACCOUNT_NAME|g" $RBAC
    echo "RBAC YAML"
    cat $RBAC
    echo "Applying RBAC"
#    kubectl apply -f $RBAC

    echo "Get secret for service account"
    SECRET_NAME=$(kubectl get sa $SERVICE_ACCOUNT_NAME --output jsonpath="{.secrets[*]['name']}")
    echo "SECRET_NAME $SECRET_NAME"

    echo "Get JWT token"
    SA_JWT_TOKEN=$(kubectl get secret $SECRET_NAME --output 'go-template={{ .data.token }}' | base64 --decode)
    echo "SA_JWT_TOKEN $SA_JWT_TOKEN"

    echo "Get cluster certificate"
    SA_CA_CRT=$(kubectl config view --raw --minify --flatten --output 'jsonpath={.clusters[].cluster.certificate-authority-data}' | base64 --decode) 
    echo "SA_CA_CRT"
    echo $SA_CA_CRT

    echo "Get K8S host url"
    K8S_HOST=$(kubectl config view --raw --minify --flatten --output 'jsonpath={.clusters[].cluster.server}')
    echo "K8S_HOST $K8S_HOST"
    setup_vault
}

setup_vault() {
    sudo su ssm-user bash -c '
    aws sts get-caller-identity
    export VAULT_ADDR=$VAULT_ADDRESS
    export VAULT_NAMESPACE=$VAULT_NAMESPACE
    vault login -method=aws role=$VAULT_ROLE
    '

so, tried the same command to switch to ssm-user in line no:50, but its throwing error:

K8S_HOST https://8EEB9E5028A9BF9F5698633B5195C178.gr7.us-east-1.eks.amazonaws.com
{
    "UserId": "AROAZI2LC42GBHI2ZIUAM:i-09255e1908a2485c7",
    "Account": "637423249036",
    "Arn": "arn:aws:sts::637423249036:assumed-role/dd-server-itda-devopssit-ue1-role/i-09255e1908a2485c7"
}
bash: line 4: vault: command not found
Cleaning up project directory and file based variables
00:00
ERROR: Job failed: exit status 1

pls help me to solve the issue
